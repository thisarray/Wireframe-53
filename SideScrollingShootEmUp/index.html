<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SideScrollingShootEmUp</title>
  <script src="../../jsgame0.js"></script>
  <script id="level" type="application/json">
{
  "foreground": [["leftforeground_narrow", 1634, 571], ["centreforeground_narrow", 1831, 571], ["centreforeground_narrow", 2072, 571], ["centreforeground_narrow", 2314, 571], ["leftvertforeground_narrow", 2420, 506], ["centreforeground", 2557, 569], ["centreforeground", 2800, 569], ["centreforeground", 3041, 569],
                 ["centreforeground", 3284, 569], ["centreforeground", 3525, 569], ["centreforeground", 3767, 569], ["leftforeground_narrow_top", 3840, 31], ["centreforeground", 4009, 569], ["centreforeground_narrow_top", 4038, 31], ["centreforeground", 4250, 569], ["centreforeground_narrow_top", 4280, 31],
                 ["centreforeground", 4492, 569], ["centreforeground_narrow_top", 4522, 31], ["centreforeground", 4734, 569], ["centreforeground_narrow_top", 4765, 31], ["centreforeground", 4976, 569], ["centreforeground_narrow_top", 5008, 31], ["leftforeground_narrow", 5081, 249], ["leftforeground_narrow_top", 5081, 314],
                 ["centreforeground", 5219, 569], ["centreforeground_narrow_top", 5251, 31], ["centreforeground_narrow", 5278, 249], ["centreforeground_narrow_top", 5279, 314], ["centreforeground", 5462, 569], ["centreforeground_narrow_top", 5493, 31], ["centreforeground_narrow", 5521, 249], ["centreforeground_narrow_top", 5522, 314],
                 ["centreforeground", 5704, 569], ["centreforeground_narrow_top", 5736, 31], ["centreforeground_narrow", 5763, 249], ["centreforeground_narrow_top", 5763, 314], ["centreforeground", 5946, 569], ["centreforeground_narrow_top", 5978, 31], ["centreforeground_narrow", 6006, 249], ["centreforeground_narrow_top", 6006, 314],
                 ["centreforeground", 6189, 569], ["centreforeground_narrow_top", 6221, 31], ["centreforeground_narrow", 6249, 249], ["centreforeground_narrow_top", 6249, 314], ["centreforeground", 6432, 569], ["centreforeground_narrow_top", 6463, 31], ["rightforeground_narrow", 6446, 249], ["rightforeground_narrow_top", 6447, 314],
                 ["centreforeground", 6675, 569], ["centreforeground_narrow_top", 6706, 31], ["centreforeground", 6918, 569], ["centreforeground_narrow_top", 6949, 31], ["centreforeground", 7161, 569], ["centreforeground_narrow_top", 7191, 31], ["centreforeground", 7403, 569], ["centreforeground_narrow_top", 7433, 31], ["centreforeground", 7645, 569],
                 ["centreforeground_narrow_top", 7675, 31], ["centreforeground", 7887, 569], ["rightforeground_narrow_top", 7873, 31], ["centreforeground", 8128, 569], ["centreforeground", 8370, 569], ["centreforeground", 8613, 569], ["centreforeground", 8856, 569], ["leftforeground", 9112, 377], ["centre", 9099, 549],
                 ["centre", 9342, 549], ["centreforeground", 9438, 377], ["centre", 9585, 548], ["centreforeground", 9680, 377], ["centre", 9827, 546], ["centreforeground", 9923, 377], ["centre", 10069, 546], ["centreforeground", 10166, 377],
                 ["centre", 10310, 546], ["centreforeground", 10409, 377], ["centre", 10551, 546], ["centreforeground", 10652, 377], ["centre", 10652, 543], ["rightvertforeground", 10788, 548], ["rightvertforeground", 10788, 377]],
  "enemy": {
    "ball": {
      "hits": 1,
      "path": [[832, 0], [790, 1], [780, 5], [770, 11], [760, 19], [750, 29], [740, 40], [730, 53], [720, 68], [710, 83], [700, 98], [690, 114], [680, 129], [670, 143], [660, 157], [650, 169], [640, 179], [630, 188], [620, 194], [610, 198], [600, 200], [590, 199], [580, 196], [570, 191], [560, 184], [550, 174], [540, 163], [530, 150], [520, 136], [510, 121], [500, 106], [490, 90], [480, 75], [470, 60], [460, 47], [450, 34], [440, 23], [430, 14], [420, 7], [410, 3], [400, 0], [390, 0], [380, 3], [370, 7], [360, 14], [350, 23], [340, 34], [330, 47], [320, 60], [310, 75], [300, 90], [290, 106], [280, 121], [270, 136], [260, 150], [250, 163], [240, 174], [230, 184], [220, 191], [210, 196], [200, 199], [190, 200], [180, 198], [170, 194], [160, 188], [150, 179], [140, 169], [130, 157], [120, 143], [110, 129], [100, 114], [90, 98], [80, 83], [70, 68], [60, 53], [50, 40], [40, 29], [30, 19], [20, 11], [10, 5], [0, 1], [-10, 0], [-160, 0]],
      "speed": 4,
      "powerup": true
    },
    "cannon": {
      "hits": 4,
      "path": [[824, 0], [-160, 0]],
      "speed": 1,
      "bullets": "more"
    },
    "cannon_top": {
      "hits": 4,
      "path": [[824, 0], [-160, 0]],
      "speed": 1,
      "bullets": "more"
    },
    "flying_saucer": {
      "hits": 10,
      "path": [[857, 0], [790, -1], [780, -3], [770, -6], [760, -11], [750, -16], [740, -23], [730, -31], [720, -40], [710, -50], [700, -60], [690, -71], [680, -83], [670, -94], [660, -106], [650, -117], [640, -129], [630, -140], [620, -150], [610, -160], [600, -169], [590, -177], [580, -184], [570, -189], [560, -194], [550, -197], [540, -199], [530, -200], [520, -199], [510, -197], [500, -194], [490, -189], [480, -184], [470, -177], [460, -169], [450, -160], [440, -150], [430, -140], [420, -129], [410, -117], [400, -106], [390, -94], [380, -83], [370, -71], [360, -60], [350, -50], [340, -40], [330, -31], [320, -23], [310, -16], [300, -11], [290, -6], [280, -3], [270, -1], [260, 0], [250, -1], [240, -3], [230, -6], [220, -11], [210, -16], [200, -23], [190, -31], [180, -40], [170, -50], [160, -60], [150, -71], [140, -83], [130, -94], [120, -106], [110, -117], [100, -129], [90, -140], [80, -150], [70, -160], [60, -169], [50, -177], [40, -184], [30, -189], [20, -194], [10, -197], [0, -199], [-10, -200], [-160, -200]],
      "speed": 3,
      "bullets": "some"
    },
    "rocket": {
      "hits": 1,
      "path": [[885, 0], [-160, 0]],
      "speed": 6,
      "movement": "accelerate"
    },
    "ship_alien": {
      "hits": 1,
      "path": [[850, 0], [762, 0], [711, -5], [680, -13], [663, -21], [634, -34], [608, -42], [578, -52], [522, -62], [459, -66], [-160, -66]],
      "speed": 4
    },
    "ship_cannon": {
      "hits": 12,
      "path": [[875, 0], [790, 0], [780, 0], [770, 1], [760, 1], [750, 2], [740, 3], [730, 4], [720, 5], [710, 6], [700, 7], [690, 9], [680, 11], [670, 12], [660, 14], [650, 16], [640, 19], [630, 21], [620, 23], [610, 26], [600, 29], [590, 31], [580, 34], [570, 37], [560, 40], [550, 43], [540, 47], [530, 50], [520, 53], [510, 57], [500, 60], [490, 64], [480, 68], [470, 71], [460, 75], [450, 79], [440, 83], [430, 86], [420, 90], [410, 94], [400, 98], [390, 102], [380, 106], [370, 110], [360, 114], [350, 117], [340, 121], [330, 125], [320, 129], [310, 132], [300, 136], [290, 140], [280, 143], [270, 147], [260, 150], [250, 153], [240, 157], [230, 160], [220, 163], [210, 166], [200, 169], [190, 171], [180, 174], [170, 177], [160, 179], [150, 181], [140, 184], [130, 186], [120, 188], [110, 189], [100, 191], [90, 193], [80, 194], [70, 195], [60, 196], [50, 197], [40, 198], [30, 199], [20, 199], [10, 200], [0, 200], [-160, 200]],
      "speed": 2,
      "bullets": "more"
    },
    "ship_fighter": {
      "hits": 6,
      "path": [[863, 0], [790, 0], [780, 1], [770, 3], [760, 5], [750, 7], [740, 11], [730, 14], [720, 19], [710, 23], [700, 29], [690, 34], [680, 40], [670, 47], [660, 53], [650, 60], [640, 68], [630, 75], [620, 83], [610, 90], [600, 98], [590, 106], [580, 114], [570, 121], [560, 129], [550, 136], [540, 143], [530, 150], [520, 157], [510, 163], [500, 169], [490, 174], [480, 179], [470, 184], [460, 188], [450, 191], [440, 194], [430, 196], [420, 198], [410, 199], [400, 200], [390, 200], [380, 199], [370, 198], [360, 196], [350, 194], [340, 191], [330, 188], [320, 184], [310, 179], [300, 174], [290, 169], [280, 163], [270, 157], [260, 150], [250, 143], [240, 136], [230, 129], [220, 121], [210, 114], [200, 106], [190, 98], [180, 90], [170, 83], [160, 75], [150, 68], [140, 60], [130, 53], [120, 47], [110, 40], [100, 34], [90, 29], [80, 23], [70, 19], [60, 14], [50, 11], [40, 7], [30, 5], [20, 3], [10, 1], [0, 0], [-160, 0]],
      "speed": 4,
      "bullets": "more"
    },
    "ship_pistol": {
      "hits": 12,
      "path": [[851, 0], [751, 4], [704, 15], [660, 33], [620, 57], [585, 87], [556, 121], [535, 158], [520, 196], [513, 235], [513, 272], [521, 307], [535, 337], [554, 363], [577, 382], [604, 395], [632, 400], [661, 398], [688, 388], [713, 371], [734, 348], [750, 319], [760, 286], [764, 250], [760, 212], [748, 173], [729, 135], [703, 100], [671, 68], [633, 42], [590, 21], [544, 7], [495, 1], [447, 1], [399, 10], [353, 25], [311, 47], [274, 74], [243, 107], [218, 143], [201, 181], [191, 219], [188, 257], [193, 293], [204, 326], [221, 353], [243, 375], [269, 390], [297, 399], [325, 399], [354, 393], [380, 379], [403, 358], [421, 332], [433, 300], [439, 265], [438, 227], [430, 188], [414, 150], [390, 114], [360, 81], [324, 52], [283, 29], [238, 12], [191, 2], [142, 0], [-160, 0]],
      "speed": 3,
      "bullets": "more"
    },
    "big_ship": {
      "hits": 1000,
      "path": [[980, 0], [624, 0]],
      "speed": 0.5,
      "movement": "boss",
      "bullets": "boss"
    }
  },
  "start": [["ship_alien",    275,   245], ["ship_alien",    261,   315], ["ship_alien",    245,   381], ["ship_alien",    230,   454], ["ship_alien",    210,   529],
            ["ship_alien",    513,   650], ["ship_alien",    496,   738], ["ship_alien",    483,   805], ["ship_alien",    465,   877], ["ship_alien",    445,   944],
            ["ball",          106,  1000], ["ship_fighter",  188,  1190], ["ship_fighter",  208,  1264], ["ship_fighter",  221,  1346], ["ship_fighter",  237,  1436],
            ["ship_fighter",  253,  1509], ["ball",          106,  1833], ["cannon",        444,  2000], ["cannon",        444,  2080], ["cannon",        444,  2160],
            ["rocket",        122,  2602], ["rocket",        173,  2659], ["rocket",        232,  2728], ["rocket",        297,  2798], ["rocket",        353,  2879],
            ["rocket",        298,  2968], ["rocket",        223,  3046], ["rocket",        160,  3120], ["cannon",        444,  3620], ["cannon",        444,  3700],
            ["cannon",        444,  3780], ["cannon_top",     94,  3960], ["cannon_top",     94,  4040], ["cannon_top",     94,  4120], ["ship_alien",    441,  4489],
            ["ship_alien",    441,  4573], ["ship_alien",    180,  4760], ["ship_alien",    180,  4807], ["ship_alien",    180,  4860], ["ship_alien",    441,  4971],
            ["ship_alien",    441,  5016], ["ship_alien",    441,  5080], ["rocket",        140,  5416], ["rocket",        408,  5540], ["rocket",        133,  5618],
            ["rocket",        419,  5694], ["ship_alien",    233,  5908], ["ship_fighter",  157,  6457], ["ship_fighter",  171,  6558], ["ship_fighter",  198,  6617],
            ["ship_fighter",  234,  6673], ["flying_saucer", 385,  7027], ["flying_saucer", 378,  7154], ["flying_saucer", 352,  7238], ["ship_alien",    392,  7564],
            ["ship_alien",    339,  7597], ["ship_alien",    281,  7631], ["ship_alien",    237,  7678], ["ship_alien",    194,  7780], ["ship_cannon",    94,  7987],
            ["ship_cannon",   114,  8175], ["ship_cannon",   161,  8300], ["ship_cannon",   209,  8484], ["cannon",        252,  9000], ["cannon",        252,  9080],
            ["cannon",        252,  9160], ["cannon",        252,  9240], ["cannon",        252,  9320], ["ship_alien",    192,  9688], ["ship_alien",    174,  9731],
            ["ship_alien",    150,  9782], ["ship_alien",    130,  9835], ["ship_alien",    111,  9899], ["ball",          164, 10644], ["flying_saucer", 480, 10903],
            ["flying_saucer", 431, 10943], ["flying_saucer", 394, 10979], ["flying_saucer", 350, 11017], ["flying_saucer", 292, 11071], ["ship_pistol",   117, 11392],
            ["ship_pistol",   125, 11507], ["ship_pistol",   151, 11611], ["ship_pistol",   179, 11756], ["ship_pistol",   131, 11988], ["ship_pistol",   100, 12098],
            ["ship_pistol",    68, 12249], ["ship_pistol",    97, 12413], ["ball",          189, 12842], ["ship_alien",    190, 13524], ["ship_alien",    210, 13561],
            ["ship_alien",    231, 13598], ["ship_alien",    247, 13637], ["ship_alien",    488, 13686], ["ship_alien",    454, 13712], ["ship_alien",    432, 13745],
            ["ship_alien",    414, 13769], ["ship_alien",    150, 13811], ["ship_alien",    438, 13845], ["ship_alien",    147, 13882], ["ship_alien",    433, 13919],
            ["ship_alien",    143, 13958], ["ship_alien",    428, 13992], ["ship_alien",    153, 14033], ["ship_alien",    416, 14075], ["ship_pistol",   138, 14288],
            ["ship_pistol",   151, 14327], ["ship_pistol",   138, 14381], ["ship_pistol",   121, 14415], ["ship_pistol",    93, 14461], ["ball",          181, 14915],
            ["big_ship",      300, 15369]]
}
  </script>
  <style type="text/css" media="screen">
body {
  background-color: white;
  color: black;
}
.hidden {
  display: none;
}
#original {
  margin-left: 1em;
}
  </style>
</head>

<body>
<section id="imageLoader" class="hidden">
  <img class="hidden" src="images/background_0.png" alt="background_0" data-name="background_0">
  <img class="hidden" src="images/background_1.png" alt="background_1" data-name="background_1">
  <img class="hidden" src="images/ball.png" alt="ball" data-name="ball">
  <img class="hidden" src="images/ball_white.png" alt="ball_white" data-name="ball_white">
  <img class="hidden" src="images/big_ship.png" alt="big_ship" data-name="big_ship">
  <img class="hidden" src="images/big_ship_white.png" alt="big_ship_white" data-name="big_ship_white">
  <img class="hidden" src="images/bullet.png" alt="bullet" data-name="bullet">
  <img class="hidden" src="images/cannon.png" alt="cannon" data-name="cannon">
  <img class="hidden" src="images/cannon_top.png" alt="cannon_top" data-name="cannon_top">
  <img class="hidden" src="images/cannon_top_white.png" alt="cannon_top_white" data-name="cannon_top_white">
  <img class="hidden" src="images/cannon_white.png" alt="cannon_white" data-name="cannon_white">
  <img class="hidden" src="images/centre.png" alt="centre" data-name="centre">
  <img class="hidden" src="images/centreforeground.png" alt="centreforeground" data-name="centreforeground">
  <img class="hidden" src="images/centreforeground_narrow.png" alt="centreforeground_narrow" data-name="centreforeground_narrow">
  <img class="hidden" src="images/centreforeground_narrow_top.png" alt="centreforeground_narrow_top" data-name="centreforeground_narrow_top">
  <img class="hidden" src="images/centreforeground_top.png" alt="centreforeground_top" data-name="centreforeground_top">
  <img class="hidden" src="images/explosion_0.png" alt="explosion_0" data-name="explosion_0">
  <img class="hidden" src="images/explosion_1.png" alt="explosion_1" data-name="explosion_1">
  <img class="hidden" src="images/explosion_2.png" alt="explosion_2" data-name="explosion_2">
  <img class="hidden" src="images/explosion_3.png" alt="explosion_3" data-name="explosion_3">
  <img class="hidden" src="images/explosion_4.png" alt="explosion_4" data-name="explosion_4">
  <img class="hidden" src="images/explosion_5.png" alt="explosion_5" data-name="explosion_5">
  <img class="hidden" src="images/explosion_6.png" alt="explosion_6" data-name="explosion_6">
  <img class="hidden" src="images/explosion_7.png" alt="explosion_7" data-name="explosion_7">
  <img class="hidden" src="images/explosion_8.png" alt="explosion_8" data-name="explosion_8">
  <img class="hidden" src="images/explosion_9.png" alt="explosion_9" data-name="explosion_9">
  <img class="hidden" src="images/flying_saucer.png" alt="flying_saucer" data-name="flying_saucer">
  <img class="hidden" src="images/flying_saucer_white.png" alt="flying_saucer_white" data-name="flying_saucer_white">
  <img class="hidden" src="images/impact_0.png" alt="impact_0" data-name="impact_0">
  <img class="hidden" src="images/impact_1.png" alt="impact_1" data-name="impact_1">
  <img class="hidden" src="images/impact_2.png" alt="impact_2" data-name="impact_2">
  <img class="hidden" src="images/impact_3.png" alt="impact_3" data-name="impact_3">
  <img class="hidden" src="images/impact_4.png" alt="impact_4" data-name="impact_4">
  <img class="hidden" src="images/impact_5.png" alt="impact_5" data-name="impact_5">
  <img class="hidden" src="images/impact_6.png" alt="impact_6" data-name="impact_6">
  <img class="hidden" src="images/impact_7.png" alt="impact_7" data-name="impact_7">
  <img class="hidden" src="images/laser.png" alt="laser" data-name="laser">
  <img class="hidden" src="images/leftforeground.png" alt="leftforeground" data-name="leftforeground">
  <img class="hidden" src="images/lives.png" alt="lives" data-name="lives">
  <img class="hidden" src="images/leftforeground_narrow.png" alt="leftforeground_narrow" data-name="leftforeground_narrow">
  <img class="hidden" src="images/leftforeground_narrow_top.png" alt="leftforeground_narrow_top" data-name="leftforeground_narrow_top">
  <img class="hidden" src="images/leftforeground_top.png" alt="leftforeground_top" data-name="leftforeground_top">
  <img class="hidden" src="images/leftvertforeground.png" alt="leftvertforeground" data-name="leftvertforeground">
  <img class="hidden" src="images/leftvertforeground_narrow.png" alt="leftvertforeground_narrow" data-name="leftvertforeground_narrow">
  <img class="hidden" src="images/leftvertforeground_narrow_top.png" alt="leftvertforeground_narrow_top" data-name="leftvertforeground_narrow_top">
  <img class="hidden" src="images/leftvertforeground_top.png" alt="leftvertforeground_top" data-name="leftvertforeground_top">
  <img class="hidden" src="images/plus.png" alt="plus" data-name="plus">
  <img class="hidden" src="images/rightforeground.png" alt="rightforeground" data-name="rightforeground">
  <img class="hidden" src="images/rightforeground_narrow.png" alt="rightforeground_narrow" data-name="rightforeground_narrow">
  <img class="hidden" src="images/rightforeground_narrow_top.png" alt="rightforeground_narrow_top" data-name="rightforeground_narrow_top">
  <img class="hidden" src="images/rightforeground_top.png" alt="rightforeground_top" data-name="rightforeground_top">
  <img class="hidden" src="images/rightvertforeground.png" alt="rightvertforeground" data-name="rightvertforeground">
  <img class="hidden" src="images/rightvertforeground_narrow.png" alt="rightvertforeground_narrow" data-name="rightvertforeground_narrow">
  <img class="hidden" src="images/rocket.png" alt="rocket" data-name="rocket">
  <img class="hidden" src="images/rightvertforeground_narrow_top.png" alt="rightvertforeground_narrow_top" data-name="rightvertforeground_narrow_top">
  <img class="hidden" src="images/rightvertforeground_top.png" alt="rightvertforeground_top" data-name="rightvertforeground_top">
  <img class="hidden" src="images/rocket_white.png" alt="rocket_white" data-name="rocket_white">
  <img class="hidden" src="images/ship_alien.png" alt="ship_alien" data-name="ship_alien">
  <img class="hidden" src="images/ship_alien_white.png" alt="ship_alien_white" data-name="ship_alien_white">
  <img class="hidden" src="images/ship_cannon.png" alt="ship_cannon" data-name="ship_cannon">
  <img class="hidden" src="images/ship_cannon_white.png" alt="ship_cannon_white" data-name="ship_cannon_white">
  <img class="hidden" src="images/ship_fighter.png" alt="ship_fighter" data-name="ship_fighter">
  <img class="hidden" src="images/ship_fighter_white.png" alt="ship_fighter_white" data-name="ship_fighter_white">
  <img class="hidden" src="images/ship_pistol.png" alt="ship_pistol" data-name="ship_pistol">
  <img class="hidden" src="images/ship_pistol_white.png" alt="ship_pistol_white" data-name="ship_pistol_white">
  <img class="hidden" src="images/spaceship.png" alt="spaceship" data-name="spaceship">
  <img class="hidden" src="images/text_0.png" alt="text_0" data-name="text_0">
  <img class="hidden" src="images/text_1.png" alt="text_1" data-name="text_1">
  <img class="hidden" src="images/text_2.png" alt="text_2" data-name="text_2">
  <img class="hidden" src="images/text_3.png" alt="text_3" data-name="text_3">
</section>

<main>
<h1>SideScrollingShootEmUp</h1>

<canvas id="screen">
The game screen appears here if your browser supports the Canvas API.
</canvas>
<section id="controls">
  <button type="button" id="reset">Reset</button>
  <button type="button" id="pause">Pause</button>
</section>

<h2>Attribution</h2>

<p><a href="https://wireframe.raspberrypi.com/issues/53">Create your own side-scrolling shoot-'em-up, pages 58-63, by Jordi Sontanja</a>.</p>

<p>Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/legalcode">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported</a>.</p>

<h2>Original Python code</h2>

<pre id="original"><code>
import pgzrun
from enum import Enum
import math
from random import randint
from pgzero.builtins import Actor
from shapely.geometry import Point, Polygon, LineString
from shapely.affinity import translate

isFastComputer = True
if isFastComputer:
    def drawBackground(screen, frame):
        screen.blit(&quot;background_1&quot;,(800-frame%(800*8)/4,0))
        screen.blit(&quot;background_0&quot;,(800-(frame+800*4)%(800*8)/4,0))

foregroundNames = [&#x27;centreforeground&#x27;, &#x27;leftforeground&#x27;, &#x27;leftvertforeground&#x27;,
                   &#x27;rightforeground&#x27;, &#x27;rightvertforeground&#x27;,
                   &#x27;centreforeground_top&#x27;, &#x27;leftforeground_top&#x27;, &#x27;leftvertforeground_top&#x27;,
                   &#x27;rightforeground_top&#x27;, &#x27;rightvertforeground_top&#x27;,
                   &#x27;centreforeground_narrow&#x27;, &#x27;centreforeground_narrow_top&#x27;,
                   &#x27;leftforeground_narrow&#x27;, &#x27;leftforeground_narrow_top&#x27;,
                   &#x27;leftvertforeground_narrow&#x27;, &#x27;leftvertforeground_narrow_top&#x27;,
                   &#x27;rightforeground_narrow&#x27;, &#x27;rightforeground_narrow_top&#x27;,
                   &#x27;rightvertforeground_narrow&#x27;, &#x27;rightvertforeground_narrow_top&#x27;,
                   &#x27;centre&#x27;]

foregroundMap = [(12,1634,571),(10,1831,571),(10,2072,571),(10,2314,571),(14,2420,506),(0,2557,569),(0,2800,569),(0,3041,569),
                 (0,3284,569),(0,3525,569),(0,3767,569),(13,3840,31),(0,4009,569),(11,4038,31),(0,4250,569),(11,4280,31),
                 (0,4492,569),(11,4522,31),(0,4734,569),(11,4765,31),(0,4976,569),(11,5008,31),(12,5081,249),(13,5081,314),
                 (0,5219,569),(11,5251,31),(10,5278,249),(11,5279,314),(0,5462,569),(11,5493,31),(10,5521,249),(11,5522,314),
                 (0,5704,569),(11,5736,31),(10,5763,249),(11,5763,314),(0,5946,569),(11,5978,31),(10,6006,249),(11,6006,314),
                 (0,6189,569),(11,6221,31),(10,6249,249),(11,6249,314),(0,6432,569),(11,6463,31),(16,6446,249),(17,6447,314),
                 (0,6675,569),(11,6706,31),(0,6918,569),(11,6949,31),(0,7161,569),(11,7191,31),(0,7403,569),(11,7433,31),(0,7645,569),
                 (11,7675,31),(0,7887,569),(17,7873,31),(0,8128,569),(0,8370,569),(0,8613,569),(0,8856,569),(1,9112,377),(20,9099,549),
                 (20,9342,549),(0,9438,377),(20,9585,548),(0,9680,377),(20,9827,546),(0,9923,377),(20,10069,546),(0,10166,377),
                 (20,10310,546),(0,10409,377),(20,10551,546),(0,10652,377),(20,10652,543),(4,10788,548),(4,10788,377)]

foregroundPolygons = [[(-122, -96), (120, -96), (120, 96), (-122, 96)], [(-204, 96), (186, -96), (204, -96), (204, 95)],
                      [(-14, 95), (-14, -95), (14, -95), (14, 95)], [(-206, -95), (-187, -95), (200, 95), (-206, 95)],
                      [(-15, -95), (12, -95), (12, 95), (-15, 95)], [(120, -95), (120, 95), (-122, 95), (-122, -95)],
                      [(204, -95), (204, 95), (186, 95), (-202, -96)], [(14, 95), (-14, 95), (-14, -95), (13, -95)],
                      [(-207, -96), (201, -96), (-187, 95), (-206, 95)], [(-15, -96), (12, -96), (12, 95), (-15, 95)],
                      [(-122, -33), (120, -33), (120, 31), (-122, 31)], [(-122, -33), (120, -33), (120, 31), (-122, 31)],
                      [(-73, 31), (56, -32), (75, -32), (75, 31)], [(75, 31), (56, 31), (-74, -33), (75, -33)],
                      [(14, 31), (-14, 31), (-14, -32), (13, -32)], [(14, 32), (-14, 32), (-14, -33), (13, -33)],
                      [(-77, -33), (-58, -33), (70, 31), (-77, 31)], [(-77, -33), (72, -33), (-58, 31), (-77, 31)],
                      [(-15, -33), (12, -33), (12, 31), (-15, 31)], [(-15, -33), (13, -33), (13, 31), (-15, 31)],
                      []]

foregroundBiggestObjectHalfXSize = 206

class Foreground:
    def __init__(self):
        self.elements = []
        self.indexes = []
        self.mapElement = 0
        self.polygons = []
    def draw(self):
        for element in self.elements:
            element.draw()
    def update(self, globalTime):
        for i in reversed(range(len(self.elements))):
            self.elements[i].x -= 1
            if self.elements[i].x &lt; -foregroundBiggestObjectHalfXSize:
                del self.elements[i]
                del self.indexes[i]
        if self.mapElement &lt; len(foregroundMap):
            while foregroundMap[self.mapElement][1] &lt; globalTime + 800 + foregroundBiggestObjectHalfXSize:
                self.indexes.append(foregroundMap[self.mapElement][0])
                self.elements.append(Actor(foregroundNames[foregroundMap[self.mapElement][0]], (foregroundMap[self.mapElement][1] - globalTime, foregroundMap[self.mapElement][2])))
                self.mapElement += 1
                if self.mapElement &gt;= len(foregroundMap):
                    break
        self.polygons = []
        for i in range(len(self.indexes)):
            polygon = translate(Polygon(foregroundPolygons[self.indexes[i]]), self.elements[i].x, self.elements[i].y)
            self.polygons.append(polygon)

class Bullet:
    def __init__(self, pos, speed):
        self.actor = Actor(&#x27;bullet&#x27;, pos)
        self.speed = speed
    def update(self):
        self.actor.x += self.speed[0]
        self.actor.y += self.speed[1]
    def draw(self):
        self.actor.draw()
class AllBullets:
    def __init__(self):
        self.bullets = []
    def update(self):
        for i in reversed(range(len(self.bullets))):
            self.bullets[i].update()
            if self.bullets[i].actor.x &lt; -4 or self.bullets[i].actor.y &lt; -4 or self.bullets[i].actor.x &gt; 804 or self.bullets[i].actor.y &gt; 604:
                del self.bullets[i]
    def draw(self):
        for bullet in self.bullets:
            bullet.draw()
    def append(self, posX, posY, velX, velY):
        self.bullets.append(Bullet((posX, posY), (velX, velY)))
    def collide(self, polygon):
        collided = False
        for i in reversed(range(len(self.bullets))):
            if Point(self.bullets[i].actor.x, self.bullets[i].actor.y).within(polygon):
                collided = True
                del self.bullets[i]
        return collided

enemyNames = [&#x27;ball&#x27;, &#x27;cannon&#x27;, &#x27;cannon_top&#x27;, &#x27;flying_saucer&#x27;,
              &#x27;rocket&#x27;, &#x27;ship_alien&#x27;, &#x27;ship_cannon&#x27;, &#x27;ship_fighter&#x27;, &#x27;ship_pistol&#x27;, &#x27;big_ship&#x27; ]

enemyPolyCoords = [[(-6, -30), (-21, -27), (-30, -19), (-33, -3), (-27, 11), (-19, 20), (-5, 30), (11, 31), (26, 17), (29, -12), (10, -23)],
                   [(-17, 29), (-13, -4), (-23, -11), (-21, -29), (9, -24), (23, -13), (18, 30)],
                   [(-17, -29), (-12, 3), (-22, 6), (-21, 27), (6, 24), (23, 12), (18, -30)],
                   [(-24, 7), (-56, 23), (53, 23), (17, 6), (17, -10), (6, -23), (-14, -23), (-22, -9)],
                   [(73, -20), (-27, -20), (-64, -14), (-85, -5), (-75, 5), (-33, 15), (11, 19), (73, 19), (83, 8), (83, -13)],
                   [(-36, -19), (-48, -10), (-50, 5), (-44, 16), (-31, 23), (-11, 23), (24, 16), (41, -20), (10, -22), (-26, -21)],
                   [(28, -31), (-74, -31), (-74, 8), (-37, 8), (-20, 22), (9, 31), (37, 30), (62, 19), (72, 13), (72, -12), (48, -24), (31, -28)],
                   [(-51, -15), (-60, -11), (-63, -1), (-54, 8), (-21, 8), (18, 22), (41, 24), (58, 18), (61, -26), (23, -24), (-19, -16)],
                   [(-50, -22), (-23, 15), (-9, 27), (4, 32), (26, 24), (42, 7), (49, -15), (41, -28), (16, -33), (7, -33), (7, -26)],
                   [(-144, -32), (-160, -35), (-173, -8), (-164, 11), (-151, 19), (-119, 24), (-142, 30), (-139, 41), (-93, 37), (-82, 31), (-72, 51), (-35, 38), (-30, 53), (5, 65), (100, 69), (108, 61), (109, 44), (152, 28), (169, 15), (169, -2), (154, -12), (127, -24), (154, -41), (70, -69), (39, -43), (21, -56), (-23, -61), (-69, -48), (-74, -42), (-96, -47), (-124, -47), (-109, -40), (-138, -35)]]

enemyNumberOfHits = [1, 4, 4, 10, 1, 1, 12, 6, 12, 1000]

enemyPaths = [[(800+32, 0), (790, 1), (780, 5), (770, 11), (760, 19), (750, 29), (740, 40), (730, 53), (720, 68), (710, 83), (700, 98), (690, 114), (680, 129), (670, 143), (660, 157), (650, 169), (640, 179), (630, 188), (620, 194), (610, 198), (600, 200), (590, 199), (580, 196), (570, 191), (560, 184), (550, 174), (540, 163), (530, 150), (520, 136), (510, 121), (500, 106), (490, 90), (480, 75), (470, 60), (460, 47), (450, 34), (440, 23), (430, 14), (420, 7), (410, 3), (400, 0), (390, 0), (380, 3), (370, 7), (360, 14), (350, 23), (340, 34), (330, 47), (320, 60), (310, 75), (300, 90), (290, 106), (280, 121), (270, 136), (260, 150), (250, 163), (240, 174), (230, 184), (220, 191), (210, 196), (200, 199), (190, 200), (180, 198), (170, 194), (160, 188), (150, 179), (140, 169), (130, 157), (120, 143), (110, 129), (100, 114), (90, 98), (80, 83), (70, 68), (60, 53), (50, 40), (40, 29), (30, 19), (20, 11), (10, 5), (0, 1), (-10, 0), (-160, 0)],
              [(800+24, 0), (-160, 0)],
              [(800+24, 0), (-160, 0)],
              [(800+57, 0), (790, -1), (780, -3), (770, -6), (760, -11), (750, -16), (740, -23), (730, -31), (720, -40), (710, -50), (700, -60), (690, -71), (680, -83), (670, -94), (660, -106), (650, -117), (640, -129), (630, -140), (620, -150), (610, -160), (600, -169), (590, -177), (580, -184), (570, -189), (560, -194), (550, -197), (540, -199), (530, -200), (520, -199), (510, -197), (500, -194), (490, -189), (480, -184), (470, -177), (460, -169), (450, -160), (440, -150), (430, -140), (420, -129), (410, -117), (400, -106), (390, -94), (380, -83), (370, -71), (360, -60), (350, -50), (340, -40), (330, -31), (320, -23), (310, -16), (300, -11), (290, -6), (280, -3), (270, -1), (260, 0), (250, -1), (240, -3), (230, -6), (220, -11), (210, -16), (200, -23), (190, -31), (180, -40), (170, -50), (160, -60), (150, -71), (140, -83), (130, -94), (120, -106), (110, -117), (100, -129), (90, -140), (80, -150), (70, -160), (60, -169), (50, -177), (40, -184), (30, -189), (20, -194), (10, -197), (0, -199), (-10, -200), (-160, -200)],
              [(800+85, 0), (-160, 0)],
              [(800+50, 0), (762, 0), (711, -5), (680, -13), (663, -21), (634, -34), (608, -42), (578, -52), (522, -62), (459, -66), (-160, -66)],
              [(800+75, 0), (790, 0), (780, 0), (770, 1), (760, 1), (750, 2), (740, 3), (730, 4), (720, 5), (710, 6), (700, 7), (690, 9), (680, 11), (670, 12), (660, 14), (650, 16), (640, 19), (630, 21), (620, 23), (610, 26), (600, 29), (590, 31), (580, 34), (570, 37), (560, 40), (550, 43), (540, 47), (530, 50), (520, 53), (510, 57), (500, 60), (490, 64), (480, 68), (470, 71), (460, 75), (450, 79), (440, 83), (430, 86), (420, 90), (410, 94), (400, 98), (390, 102), (380, 106), (370, 110), (360, 114), (350, 117), (340, 121), (330, 125), (320, 129), (310, 132), (300, 136), (290, 140), (280, 143), (270, 147), (260, 150), (250, 153), (240, 157), (230, 160), (220, 163), (210, 166), (200, 169), (190, 171), (180, 174), (170, 177), (160, 179), (150, 181), (140, 184), (130, 186), (120, 188), (110, 189), (100, 191), (90, 193), (80, 194), (70, 195), (60, 196), (50, 197), (40, 198), (30, 199), (20, 199), (10, 200), (0, 200), (-160, 200)],
              [(800+63, 0), (790, 0), (780, 1), (770, 3), (760, 5), (750, 7), (740, 11), (730, 14), (720, 19), (710, 23), (700, 29), (690, 34), (680, 40), (670, 47), (660, 53), (650, 60), (640, 68), (630, 75), (620, 83), (610, 90), (600, 98), (590, 106), (580, 114), (570, 121), (560, 129), (550, 136), (540, 143), (530, 150), (520, 157), (510, 163), (500, 169), (490, 174), (480, 179), (470, 184), (460, 188), (450, 191), (440, 194), (430, 196), (420, 198), (410, 199), (400, 200), (390, 200), (380, 199), (370, 198), (360, 196), (350, 194), (340, 191), (330, 188), (320, 184), (310, 179), (300, 174), (290, 169), (280, 163), (270, 157), (260, 150), (250, 143), (240, 136), (230, 129), (220, 121), (210, 114), (200, 106), (190, 98), (180, 90), (170, 83), (160, 75), (150, 68), (140, 60), (130, 53), (120, 47), (110, 40), (100, 34), (90, 29), (80, 23), (70, 19), (60, 14), (50, 11), (40, 7), (30, 5), (20, 3), (10, 1), (0, 0), (-160, 0)],
              [(800+51, 0), (751, 4), (704, 15), (660, 33), (620, 57), (585, 87), (556, 121), (535, 158), (520, 196), (513, 235), (513, 272), (521, 307), (535, 337), (554, 363), (577, 382), (604, 395), (632, 400), (661, 398), (688, 388), (713, 371), (734, 348), (750, 319), (760, 286), (764, 250), (760, 212), (748, 173), (729, 135), (703, 100), (671, 68), (633, 42), (590, 21), (544, 7), (495, 1), (447, 1), (399, 10), (353, 25), (311, 47), (274, 74), (243, 107), (218, 143), (201, 181), (191, 219), (188, 257), (193, 293), (204, 326), (221, 353), (243, 375), (269, 390), (297, 399), (325, 399), (354, 393), (380, 379), (403, 358), (421, 332), (433, 300), (439, 265), (438, 227), (430, 188), (414, 150), (390, 114), (360, 81), (324, 52), (283, 29), (238, 12), (191, 2), (142, 0), (-160, 0)],
              [(800+180, 0), (800-176, 0)]]

enemySpeeds = [4, 1, 1, 3, 6, 4, 2, 4, 3, 0.5 ]

def PositionFromLength(path, length):
    totalLength = 0.0
    for i in range(1, len(path)):
        dx = path[i][0] - path[i-1][0]
        dy = path[i][1] - path[i-1][1]
        nextLength = math.sqrt(dx*dx + dy*dy)
        if length &lt;= totalLength + nextLength:
            localParameter = (length - totalLength) / nextLength
            return True, (path[i-1][0] + localParameter * dx, path[i-1][1] + localParameter * dy)
        totalLength += nextLength
    return False, path[-1]

def Accelerate(path, length):
    length = length * length / 800
    return PositionFromLength(path, length)

def BigBossMovement(path, length):
    inPath, position = PositionFromLength(path, length)
    if inPath:
        return True, position
    totalLength = path[0][0] - path[1][0]
    return True, (position[0], 200*math.sin((length-totalLength)/40))

enemyMovement = [PositionFromLength, PositionFromLength, PositionFromLength, PositionFromLength,
                 Accelerate, PositionFromLength, PositionFromLength, PositionFromLength,
                 PositionFromLength, BigBossMovement ]

def NoBullets(bullets, spaceShip, posX, posY, length, speed):
    pass

def BulletToSpaceship(bullets, spaceShip, posX, posY, speed):
    dx = spaceShip.actor.x - posX
    dy = spaceShip.actor.y - posY
    distance = math.sqrt(dx*dx + dy*dy)
    if distance &gt; 20:
        bullets.append(posX, posY, dx / distance * (speed+3.0), dy / distance * (speed+3.0))

def SomeBulletsToSpaceship(bullets, spaceShip, posX, posY, length, speed):
    if 0 == randint(0,300):
        BulletToSpaceship(bullets, spaceShip, posX, posY, speed)

def MoreBulletsToSpaceship(bullets, spaceShip, posX, posY, length, speed):
    if 0 == randint(0,100):
        BulletToSpaceship(bullets, spaceShip, posX, posY, speed)

def BulletsBigBoss(bullets, spaceShip, posX, posY, length, speed):
    if length &lt; 360:
        MoreBulletsToSpaceship(bullets, spaceShip, posX, posY, length, speed)
        MoreBulletsToSpaceship(bullets, spaceShip, posX, posY, length, speed)
    else:
        if 0 == round(length*2) % 50:
            for i in range(0, 360, 20):
                bullets.append(posX, posY, 3.0 * math.sin(i / 180.0 * math.pi), 3.0 * math.cos(i / 180.0 * math.pi))
        elif 0 == round(length*2) % 71:
            for i in range(0, 360, 10):
                bullets.append(posX, posY, 3.0 * math.sin(i / 180.0 * math.pi), 3.0 * math.cos(i / 180.0 * math.pi))

bulletStrategy = [NoBullets, MoreBulletsToSpaceship, MoreBulletsToSpaceship, SomeBulletsToSpaceship,
                  NoBullets, NoBullets, MoreBulletsToSpaceship, MoreBulletsToSpaceship,
                  MoreBulletsToSpaceship, BulletsBigBoss ]

def NoPowerup(powerups, posX, posY):
    pass

def AddPowerup(powerups, posX, posY):
    powerups.append(posX, posY)

powerUpStrategy = [AddPowerup, NoPowerup, NoPowerup, NoPowerup,
                   NoPowerup, NoPowerup, NoPowerup, NoPowerup,
                   NoPowerup, NoPowerup ]

class Enemy:
    def __init__(self, index, startY):
        self.index = index
        self.startY = startY
        self.actor = Actor(enemyNames[index], (800+200,startY))
        self.actorWhite = Actor(enemyNames[index]+&quot;_white&quot;, (800+200,startY))
        self.positionInPath = 0.0
        self.polygon = Polygon(enemyPolyCoords[index])
        self.numberOfHits = enemyNumberOfHits[index]
        self.lastHit = 0
    def draw(self):
        if self.lastHit == 0:
            self.actor.draw()
        else:
            self.actorWhite.draw()
            self.lastHit -= 1
    def translate(self, posX, posY):
        self.actor.x = self.actorWhite.x = posX
        self.actor.y = self.actorWhite.y = posY
    def update(self, bullets, spaceShip):
        self.positionInPath += enemySpeeds[self.index]
        active, position = enemyMovement[self.index](enemyPaths[self.index], self.positionInPath)
        if active:
            self.translate(position[0], position[1] + self.startY)
            bulletStrategy[self.index](bullets, spaceShip, position[0], position[1] + self.startY, self.positionInPath, enemySpeeds[self.index])
        return active
    def hit(self, powerups):
        self.numberOfHits -= 1
        if self.numberOfHits &lt;= 0:
            powerUpStrategy[self.index](powerups, self.actor.x, self.actor.y)
            return True
        self.lastHit = 5
        return False

enemyStart = [[5, 275,   245], [5, 261,   315], [5, 245,   381], [5, 230,   454], [5, 210,   529],
              [5, 513,   650], [5, 496,   738], [5, 483,   805], [5, 465,   877], [5, 445,   944],
              [0, 106,  1000], [7, 188,  1190], [7, 208,  1264], [7, 221,  1346], [7, 237,  1436],
              [7, 253,  1509], [0, 106,  1833], [1, 444,  2000], [1, 444,  2080], [1, 444,  2160],
              [4, 122,  2602], [4, 173,  2659], [4, 232,  2728], [4, 297,  2798], [4, 353,  2879],
              [4, 298,  2968], [4, 223,  3046], [4, 160,  3120], [1, 444,  3620], [1, 444,  3700],
              [1, 444,  3780], [2,  94,  3960], [2,  94,  4040], [2,  94,  4120], [5, 441,  4489],
              [5, 441,  4573], [5, 180,  4760], [5, 180,  4807], [5, 180,  4860], [5, 441,  4971],
              [5, 441,  5016], [5, 441,  5080], [4, 140,  5416], [4, 408,  5540], [4, 133,  5618],
              [4, 419,  5694], [5, 233,  5908], [7, 157,  6457], [7, 171,  6558], [7, 198,  6617],
              [7, 234,  6673], [3, 385,  7027], [3, 378,  7154], [3, 352,  7238], [5, 392,  7564],
              [5, 339,  7597], [5, 281,  7631], [5, 237,  7678], [5, 194,  7780], [6,  94,  7987],
              [6, 114,  8175], [6, 161,  8300], [6, 209,  8484], [1, 252,  9000], [1, 252,  9080],
              [1, 252,  9160], [1, 252,  9240], [1, 252,  9320], [5, 192,  9688], [5, 174,  9731],
              [5, 150,  9782], [5, 130,  9835], [5, 111,  9899], [0, 164, 10644], [3, 480, 10903],
              [3, 431, 10943], [3, 394, 10979], [3, 350, 11017], [3, 292, 11071], [8, 117, 11392],
              [8, 125, 11507], [8, 151, 11611], [8, 179, 11756], [8, 131, 11988], [8, 100, 12098],
              [8,  68, 12249], [8, 97,  12413], [0, 189, 12842], [5, 190, 13524], [5, 210, 13561],
              [5, 231, 13598], [5, 247, 13637], [5, 488, 13686], [5, 454, 13712], [5, 432, 13745],
              [5, 414, 13769], [5, 150, 13811], [5, 438, 13845], [5, 147, 13882], [5, 433, 13919],
              [5, 143, 13958], [5, 428, 13992], [5, 153, 14033], [5, 416, 14075], [8, 138, 14288],
              [8, 151, 14327], [8, 138, 14381], [8, 121, 14415], [8,  93, 14461], [0, 181, 14915],
              [9, 300, 15369]]

class EnemyList:
    def __init__(self):
        self.listEnemies = []
        self.nextEnemyIndex = 0
        self.allPolygons = []
    def draw(self):
        for enemy in self.listEnemies:
            enemy.draw()
    def update(self, globalTime, bullets, spaceShip):
        for i in reversed(range(len(self.listEnemies))):
            active = self.listEnemies[i].update(bullets, spaceShip)
            if not active:
                del self.listEnemies[i]
        if self.nextEnemyIndex &lt; len(enemyStart):
            if globalTime &gt;= enemyStart[self.nextEnemyIndex][2]:
                self.listEnemies.append(Enemy(enemyStart[self.nextEnemyIndex][0], enemyStart[self.nextEnemyIndex][1]))
                self.nextEnemyIndex += 1
        self.allPolygons = []
        for enemy in self.listEnemies:
            polygon = translate(enemy.polygon, enemy.actor.x, enemy.actor.y)
            self.allPolygons.append(polygon)
    def destroyEnemy(self, index, explosions):
        explosions.append(1, self.listEnemies[index].actor.x, self.listEnemies[index].actor.y)
        del self.listEnemies[index]
        del self.allPolygons[index]
    def laserHit(self, index, powerups, explosions):
        destroyed = self.listEnemies[index].hit(powerups)
        if destroyed:
            self.destroyEnemy(index, explosions)

shipName = &#x27;spaceship&#x27;
shipPolyCoords = [(-48, -5), (4, -9), (10, -3), (40, 1), (19, 5), (-1, 5), (-1, 18), (-37, 18)]

class SpaceShip:
    def __init__(self):
        self.actor = Actor(shipName, (100,300))
        self.centredPolygon = Polygon(shipPolyCoords)
        self.polygon = translate(self.centredPolygon, self.actor.x, self.actor.y)
        self.numberOfLasers = 1
        self.vulnerable = True
        self.lastHit = 0
        self.numberOfLives = 3
    def draw(self):
        if self.vulnerable:
            self.actor.draw()
        elif self.lastHit &lt; 120 and 0 == (self.lastHit // 3) % 2:
            self.actor.draw()
    def update(self):
        if not self.vulnerable:
            self.lastHit -= 1
            if self.lastHit == 0:
                self.vulnerable = True
    def translate(self, dispX, dispY):
        self.actor.x += dispX
        self.actor.y += dispY
        if self.actor.x &lt; 45:
            self.actor.x = 45
        elif self.actor.x &gt; 800-48:
            self.actor.x = 800-48
        if self.actor.y &lt; 9:
            self.actor.y = 9
        elif self.actor.y &gt; 600-18:
            self.actor.y = 600-18
        self.polygon = translate(self.centredPolygon, self.actor.x, self.actor.y)
    def shootLaser(self, lasers):
        if self.numberOfLives != 0 and self.lastHit &lt; 120:
            startY = (self.numberOfLasers - 1) / 2 * 10
            for i in range(self.numberOfLasers):
                lasers.addLaser((self.actor.x + 20, self.actor.y+2 - startY + i * 10))
    def hit(self, explosions, showScore):
        if self.vulnerable:
            self.numberOfLives -= 1
            showScore.update(self.numberOfLives)
            self.lastHit = 180
            self.numberOfLasers = 1
            explosions.append(1, self.actor.x, self.actor.y)
            self.actor.x = 100
            self.actor.y = 300
            self.polygon = translate(self.centredPolygon, self.actor.x, self.actor.y)
            self.vulnerable = False

class Lasers:
    def __init__(self):
        self.allLasers = []
    def draw(self):
        for laser in self.allLasers:
            laser.draw()
    def update(self):
        for i in reversed(range(len(self.allLasers))):
            self.allLasers[i].x += 20
            if self.allLasers[i].x &gt; 800+10:
                del self.allLasers[i]
    def addLaser(self, position):
        self.allLasers.append(Actor(&#x27;laser&#x27;, position))

class PowerUps():
    def __init__(self):
        self.powerups = []
    def draw(self):
        for powerup in self.powerups:
            powerup.draw()
    def update(self):
        for i in reversed(range(len(self.powerups))):
            self.powerups[i].x -= 1
            if self.powerups[i].x &lt; -16:
                del self.powerups[i]
    def append(self, posX, posY):
        self.powerups.append(Actor(&quot;plus&quot;, (posX, posY)))

class ShowScore():
    def __init__(self, number):
        self.ship = Actor(&quot;lives&quot;, (37, 20))
        self.number1 = Actor(&quot;text_0&quot;, (80, 20))
        self.number2 = Actor(&quot;text_&quot;+str(number), (108, 20))
    def draw(self):
        self.ship.draw()
        self.number1.draw()
        self.number2.draw()
    def update(self, number):
        self.number2.image = &quot;text_&quot;+str(number)

explosionNames = [&quot;impact_&quot;, &quot;explosion_&quot;]
explosionFrames = [8, 10]

class Explosion():
    def __init__(self, index, posX, posY):
        self.index = index
        self.actor = Actor(explosionNames[index]+&quot;0&quot;, (posX, posY))
        self.imageIndex = 0
        self.frame = 0
    def draw(self):
        self.actor.draw()
    def update(self):
        self.frame += 1
        if 0 == self.frame % 6:
            self.imageIndex += 1
            if self.imageIndex &lt; explosionFrames[self.index]:
                self.actor.image = explosionNames[self.index]+str(self.imageIndex)
            else:
                return False
        return True

class ExplosionList():
    def __init__(self):
        self.explosions = []
    def draw(self):
        for explosion in self.explosions:
            explosion.draw()
    def update(self):
        for i in reversed(range(len(self.explosions))):
            active = self.explosions[i].update()
            if not active:
                del self.explosions[i]
    def append(self, index, posX, posY):
        self.explosions.append(Explosion(index, posX, posY))

def collisionShipBullets(bullets, spaceShip, explosions, showScore):
    if bullets.collide(spaceShip.polygon):
        spaceShip.hit(explosions, showScore)

def collisionBulletsForeground(bullets, foreground, explosions):
    for i in reversed(range(len(bullets.bullets))):
        for poly in foreground.polygons:
            point = Point(bullets.bullets[i].actor.x, bullets.bullets[i].actor.y)
            if point.within(poly):
                explosions.append(0, point.x, point.y)
                del bullets.bullets[i]
                break

def collisionLaserForeground(lasers, foreground, explosions):
    for j in reversed(range(len(lasers.allLasers))):
        laserLine = LineString([(lasers.allLasers[j].x - 26, lasers.allLasers[j].y),
                                (lasers.allLasers[j].x + 26, lasers.allLasers[j].y)])
        for i in reversed(range(len(foreground.polygons))):
            if not laserLine.disjoint(foreground.polygons[i]):
                explosions.append(0, lasers.allLasers[j].x + 26, lasers.allLasers[j].y)
                del lasers.allLasers[j]
                break

def collisionLaserEnemies(lasers, enemyList, explosions, powerups):
    for j in reversed(range(len(lasers.allLasers))):
        laserLine = LineString([(lasers.allLasers[j].x - 26, lasers.allLasers[j].y),
                                (lasers.allLasers[j].x + 26, lasers.allLasers[j].y)])
        for i in reversed(range(len(enemyList.allPolygons))):
            if not laserLine.disjoint(enemyList.allPolygons[i]):
                explosions.append(0, lasers.allLasers[j].x + 26, lasers.allLasers[j].y)
                enemyList.laserHit(i, powerups, explosions)
                del lasers.allLasers[j]
                break

def collisionShipPolygons(spaceShip, polygons):
    for i in reversed(range(len(polygons))):
        if not spaceShip.polygon.disjoint(polygons[i]):
            return True, i
    return False, 0

def collisionShipForeground(spaceShip, foreground, explosions, showScore):
    hit, index = collisionShipPolygons(spaceShip, foreground.polygons)
    if hit:
        spaceShip.hit(explosions, showScore)

def collisionShipEnemies(spaceShip, enemyList, explosions, showScore, powerups):
    hit, index = collisionShipPolygons(spaceShip, enemyList.allPolygons)
    if hit:
        spaceShip.hit(explosions, showScore)
        enemyList.laserHit(index, powerups, explosions)

def collisionShipPowerUps(spaceShip, powerups):
    for i in reversed(range(len(powerups.powerups))):
        polygon = Polygon([(powerups.powerups[i].x-16, powerups.powerups[i].y-16),
                           (powerups.powerups[i].x-16, powerups.powerups[i].y+16),
                           (powerups.powerups[i].x+16, powerups.powerups[i].y+16),
                           (powerups.powerups[i].x+16, powerups.powerups[i].y-16)])
        if not spaceShip.polygon.disjoint(polygon):
            spaceShip.numberOfLasers += 1
            del powerups.powerups[i]

foreground = Foreground()
bullets = AllBullets()
enemyList = EnemyList()
spaceShip = SpaceShip()
lasers = Lasers()
powerups = PowerUps()
showScore = ShowScore(spaceShip.numberOfLives)
explosions = ExplosionList()

Status = Enum(&#x27;Status&#x27;, &#x27;PLAYING GAME_OVER LEVEL_CLEAR&#x27;)
gameStatus = Status.PLAYING
globalTime = 0

def draw():
    if isFastComputer:
        drawBackground(screen, globalTime)
    else:
        screen.clear()
    foreground.draw()
    enemyList.draw()
    if gameStatus != Status.GAME_OVER:
        spaceShip.draw()
    powerups.draw()
    lasers.draw()
    bullets.draw()
    explosions.draw()
    showScore.draw()
    if gameStatus == Status.GAME_OVER:
        screen.draw.text(&quot;GAME OVER&quot;, center=(400, 260), fontsize=55, color=(255,0,0))
    elif gameStatus == Status.LEVEL_CLEAR:
        screen.draw.text(&quot;LEVEL CLEAR&quot;, center=(400, 260), fontsize=55, color=(0,0,255))

def update():
    global globalTime, gameStatus
    globalTime += 1
    bullets.update()
    lasers.update()
    powerups.update()
    foreground.update(globalTime)
    enemyList.update(globalTime, bullets, spaceShip)
    if gameStatus != Status.GAME_OVER:
        if keyboard.left:  spaceShip.translate(-4,  0)
        if keyboard.right: spaceShip.translate( 4,  0)
        if keyboard.up:    spaceShip.translate( 0, -4)
        if keyboard.down:  spaceShip.translate( 0,  4)
    spaceShip.update()
    explosions.update()
    collisionBulletsForeground(bullets, foreground, explosions)
    collisionLaserForeground(lasers, foreground, explosions)
    collisionLaserEnemies(lasers, enemyList, explosions, powerups)
    if gameStatus == Status.PLAYING:
        collisionShipBullets(bullets, spaceShip, explosions, showScore)
        collisionShipForeground(spaceShip, foreground, explosions, showScore)
        collisionShipEnemies(spaceShip, enemyList, explosions, showScore, powerups)
        collisionShipPowerUps(spaceShip, powerups)
        if spaceShip.numberOfLives == 0:
            gameStatus = Status.GAME_OVER
        elif globalTime &gt; enemyStart[-1][2] + 10 and len(enemyList.listEnemies) == 0:
            gameStatus = Status.LEVEL_CLEAR

def on_key_down(key):
    if key == keys.SPACE:
        spaceShip.shootLaser(lasers)

pgzrun.go()
</code></pre>
</main>

<script>
/*
 * A white-on-black bit array Mask for an image.
 *
 * The transparent parts of an image are 0 and the visible parts are 1.
 */
class Mask {
  constructor(width, height) {
    if (typeof width !== 'number') {
      throw new TypeError('width must be a positive number.');
    }
    if (typeof height !== 'number') {
      throw new TypeError('height must be a positive number.');
    }
    if (width <= 0) {
      throw new RangeError('width must be a positive number.');
    }
    if (height <= 0) {
      throw new RangeError('height must be a positive number.');
    }

    this.width = width;
    this.height = height;
    this.data = new Array(this.width * this.height).fill(0);
  }

  /*
   * Return the number index for (x, y).
   */
  _coordinatesToIndex(x, y) {
    return x + (y * this.width);
  }

  /*
   * Return the bit at (x, y).
   */
  get(x, y) {
    if (x < 0) {
      return 0;
    }
    if (y < 0) {
      return 0;
    }
    if (x >= this.width) {
      return 0;
    }
    if (y >= this.height) {
      return 0;
    }
    return this.data[this._coordinatesToIndex(x, y)];
  }

  /*
   * Set the bit at (x, y) to value.
   */
  set(x, y, value) {
    if (x < 0) {
      return;
    }
    if (y < 0) {
      return;
    }
    if (x >= this.width) {
      return;
    }
    if (y >= this.height) {
      return;
    }
    if (value === 0) {
      this.data[this._coordinatesToIndex(x, y)] = 0;
    }
    else if (value === 1) {
      this.data[this._coordinatesToIndex(x, y)] = 1;
    }
  }

  /*
   * Return true if the image has no transparent part.
   */
  isSolid() {
    return this.data.every(b => (b === 1));
  }
}

class MaskedActor extends Actor {
  /*
   * Map the string name of the image to its Mask object.
   */
  static MASK_MAP = new Map();

  collidepoint(pos) {
    if (super.collidepoint(pos)) {
      // If pos is within bounds, then check if it is at a visible pixel
      let mask = MaskedActor.MASK_MAP.get(this.name);
      if (mask instanceof Mask) {
        return (mask.get(Math.floor(pos[0] - this.x), Math.floor(pos[1] - this.y)) === 1);
      }
      return true;
    }
    return false;
  }

  colliderect(actor) {
    if (super.colliderect(actor)) {
      // If actor overlaps, then do more detailed collision detection
      let overlapLeft = Math.floor(Math.max(this.x, actor.x)),
          overlapTop = Math.floor(Math.max(this.y, actor.y)),
          overlapRight = Math.floor(Math.min(this.right, actor.right)),
          overlapBottom = Math.floor(Math.min(this.bottom, actor.bottom)),
          thisMask = MaskedActor.MASK_MAP.get(this.name),
          otherMask;
      if (!(thisMask instanceof Mask)) {
        // If there is no mask for this instance, then return the result of colliderect()
        return true;
      }

      if (actor instanceof MaskedActor) {
        otherMask = MaskedActor.MASK_MAP.get(actor.name);
      }

      for (let x = overlapLeft; x < overlapRight; x++) {
        for (let y = overlapTop; y < overlapBottom; y++) {
          if (thisMask.get(Math.floor(x - this.x), Math.floor(y - this.y)) === 1) {
          // If the current pixel is visible for this instance
            if (otherMask instanceof Mask) {
              // If there is a mask for actor, then check if the current pixel is visible for actor
              if (otherMask.get(Math.floor(x - actor.x), Math.floor(y - actor.y)) === 1) {
                return true;
              }
            }
            else {
              // There is no mask for actor so assume all of actor is visible
              // Then we have a collision
              return true;
            }
          }
        }
      }
    }
    return false;
  }
}

/*
 * Return a random integer N such that min <= N < max.
 */
function getRandomInteger(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor((Math.random() * (max - min)) + min);
}

function drawBackground(screen, frame) {
  screen.blit("background_1", [800 - ((frame % (800 * 8)) / 4), 0]);
  screen.blit("background_0", [800 - (((frame + (800 * 4)) % (800 * 8)) / 4), 0]);
}

const LEVEL_DATA = JSON.parse(document.querySelector('#level').textContent);

const FOREGROUND_BIGGEST_OBJECT_HALF_X_SIZE = 206;

class Foreground {
  constructor() {
    this.elements = [];
    this.mapElement = 0;
  }

  draw() {
    for (let element of this.elements) {
      element.draw();
    }
  }

  update(globalTime) {
    for (let i = (this.elements.length - 1); i > -1; i--) {
      this.elements[i].posx -= 1;
      if (this.elements[i].posx < -FOREGROUND_BIGGEST_OBJECT_HALF_X_SIZE) {
        this.elements.splice(i, 1);
      }
    }
    if (this.mapElement < LEVEL_DATA['foreground'].length) {
      while (LEVEL_DATA['foreground'][this.mapElement][1] < (globalTime + 800 + FOREGROUND_BIGGEST_OBJECT_HALF_X_SIZE)) {
        let actor = new MaskedActor(LEVEL_DATA['foreground'][this.mapElement][0]);
        actor.pos = [LEVEL_DATA['foreground'][this.mapElement][1] - globalTime, LEVEL_DATA['foreground'][this.mapElement][2]];
        this.elements.push(actor);
        this.mapElement += 1;
        if (this.mapElement >= LEVEL_DATA['foreground'].length) {
          break;
        }
      }
    }
  }
}

class Bullet {
  constructor(pos, speed) {
    this.actor = new Actor('bullet');
    this.actor.pos = pos;
    this.speed = speed;
  }

  draw() {
    this.actor.draw();
  }

  update() {
    this.actor.posx += this.speed[0];
    this.actor.posy += this.speed[1];
  }
}

class AllBullets {
  constructor() {
    this.bullets = [];
  }

  draw() {
    for (let bullet of this.bullets) {
      bullet.draw();
    }
  }

  update() {
    for (let i = (this.bullets.length - 1); i > -1; i--) {
      this.bullets[i].update();
      if ((this.bullets[i].actor.posx < -4) || (this.bullets[i].actor.posy < -4) || (this.bullets[i].actor.posx > 804) || (this.bullets[i].actor.posy > 604)) {
        this.bullets.splice(i, 1);
      }
    }
  }

  append(posX, posY, velX, velY) {
    this.bullets.push(new Bullet([posX, posY], [velX, velY]));
  }

  collide(target) {
    let collided = false;
    for (let i = (this.bullets.length - 1); i > -1; i--) {
      if (target.actor.collidepoint(this.bullets[i].actor.pos)) {
        collided = true;
        this.bullets.splice(i, 1);
      }
    }
    return collided;
  }
}

function PositionFromLength(path, length) {
  let totalLength = 0.0,
      dx, dy, nextLength, localParameter;
  for (let i = 1; i < path.length; i++) {
    dx = path[i][0] - path[i-1][0];
    dy = path[i][1] - path[i-1][1];
    nextLength = Math.sqrt((dx * dx) + (dy * dy));
    if (length <= (totalLength + nextLength)) {
      localParameter = (length - totalLength) / nextLength;
      return [true, [path[i-1][0] + (localParameter * dx), path[i-1][1] + (localParameter * dy)]];
    }
    totalLength += nextLength;
  }
  return [false, path[-1]];
}

function Accelerate(path, length) {
  length = length * length / 800;
  return PositionFromLength(path, length);
}

function BigBossMovement(path, length) {
  let [inPath, position] = PositionFromLength(path, length);
  if (inPath) {
    return [true, position];
  }
  totalLength = path[0][0] - path[1][0];
  return [true, [position[0], 200 * Math.sin((length - totalLength) / 40)]];
}

function NoBullets(bullets, spaceShip, posX, posY, length, speed) {
}

function BulletToSpaceship(bullets, spaceShip, posX, posY, speed) {
  let dx = spaceShip.actor.posx - posX,
      dy = spaceShip.actor.posy - posY,
      distance = Math.sqrt((dx * dx) + (dy * dy));
  if (distance > 20) {
    bullets.append(posX, posY, (dx / distance) * (speed + 3.0), (dy / distance) * (speed + 3.0));
  }
}

function SomeBulletsToSpaceship(bullets, spaceShip, posX, posY, length, speed) {
  if (0 === getRandomInteger(0, 301)) {
    BulletToSpaceship(bullets, spaceShip, posX, posY, speed);
  }
}

function MoreBulletsToSpaceship(bullets, spaceShip, posX, posY, length, speed) {
  if (0 === getRandomInteger(0, 101)) {
    BulletToSpaceship(bullets, spaceShip, posX, posY, speed);
  }
}

function BulletsBigBoss(bullets, spaceShip, posX, posY, length, speed) {
  if (length < 360) {
    MoreBulletsToSpaceship(bullets, spaceShip, posX, posY, length, speed);
    MoreBulletsToSpaceship(bullets, spaceShip, posX, posY, length, speed);
  }
  else {
    if (0 === (Math.round(length * 2) % 50)) {
      for (let i = 0; i < 360; i += 20) {
        bullets.append(posX, posY, 3.0 * Math.sin(i / 180.0 * Math.PI), 3.0 * Math.cos(i / 180.0 * Math.PI));
      }
    }
    else if (0 === (Math.round(length * 2) % 71)) {
      for (let i = 0; i < 360; i += 10) {
        bullets.append(posX, posY, 3.0 * Math.sin(i / 180.0 * Math.PI), 3.0 * Math.cos(i / 180.0 * Math.PI));
      }
    }
  }
}

class Enemy {
  constructor(index, startY) {
    this.index = index;
    this.startY = startY;
    this.actor = new MaskedActor(index);
    this.actor.pos = [800 + 200, startY];
    this.actorWhite = new Actor(index + "_white");
    this.actorWhite.pos = [800 + 200, startY];
    this.positionInPath = 0.0;
    this.numberOfHits = LEVEL_DATA['enemy'][index].hits;
    this.lastHit = 0;
  }

  draw() {
    if (this.lastHit === 0) {
      this.actor.draw();
    }
    else {
      this.actorWhite.draw();
      this.lastHit -= 1;
    }
  }

  translate(posX, posY) {
    this.actor.posx = posX;
    this.actor.posy = posY;
    this.actorWhite.posx = posX;
    this.actorWhite.posy = posY;
  }

  update(bullets, spaceShip) {
    this.positionInPath += LEVEL_DATA['enemy'][this.index].speed;
    let [active, position] = LEVEL_DATA['enemy'][this.index].movements(LEVEL_DATA['enemy'][this.index].path, this.positionInPath);
    if (active) {
      this.translate(position[0], position[1] + this.startY);
      LEVEL_DATA['enemy'][this.index].bullets(bullets, spaceShip, position[0], position[1] + this.startY, this.positionInPath, LEVEL_DATA['enemy'][this.index].speed);
    }
    return active;
  }

  hit(powerups) {
    this.numberOfHits -= 1;
    if (this.numberOfHits <= 0) {
      if ('powerup' in LEVEL_DATA['enemy'][this.index]) {
        powerups.append(this.actor.posx, this.actor.posy);
      }
      return true;
    }
    this.lastHit = 5;
    return false;
  }
}

class EnemyList {
  constructor() {
    this.listEnemies = [];
    this.nextEnemyIndex = 0;
  }

  draw() {
    for (let enemy of this.listEnemies) {
      enemy.draw();
    }
  }

  update(globalTime, bullets, spaceShip) {
    for (let i = (this.listEnemies.length - 1); i > -1; i--) {
      if (!this.listEnemies[i].update(bullets, spaceShip)) {
        this.listEnemies.splice(i, 1);
      }
    }
    if (this.nextEnemyIndex < LEVEL_DATA['start'].length) {
      if (globalTime >= LEVEL_DATA['start'][this.nextEnemyIndex][2]) {
        this.listEnemies.push(new Enemy(LEVEL_DATA['start'][this.nextEnemyIndex][0], LEVEL_DATA['start'][this.nextEnemyIndex][1]));
        this.nextEnemyIndex += 1;
      }
    }
  }

  destroyEnemy(index, explosions) {
    explosions.append(1, this.listEnemies[index].actor.posx, this.listEnemies[index].actor.posy);
    this.listEnemies.splice(index, 1);
  }

  laserHit(index, powerups, explosions) {
    if (this.listEnemies[index].hit(powerups)) {
      this.destroyEnemy(index, explosions);
    }
  }
}

class SpaceShip {
  constructor() {
    this.actor = new MaskedActor('spaceship');
    this.actor.pos = [100, 300];
    this.numberOfLasers = 1;
    this.vulnerable = true;
    this.lastHit = 0;
    this.numberOfLives = 3;
  }

  draw() {
    if (this.vulnerable) {
      this.actor.draw();
    }
    else if ((this.lastHit < 120) && (0 === (Math.floor(this.lastHit / 3) % 2))) {
      this.actor.draw();
    }
  }

  update() {
    if (!this.vulnerable) {
      this.lastHit -= 1;
      if (this.lastHit === 0) {
        this.vulnerable = true;
      }
    }
  }

  translate(dispX, dispY) {
    this.actor.posx += dispX;
    this.actor.posy += dispY;
    if (this.actor.posx < 45) {
      this.actor.posx = 45;
    }
    else if (this.actor.posx > (800 - 48)) {
      this.actor.posx = 800 - 48;
    }
    if (this.actor.posy < 9) {
      this.actor.posy = 9;
    }
    else if (this.actor.posy > (600 - 18)) {
      this.actor.posy = 600 - 18;
    }
  }

  shootLaser(lasers) {
    if ((this.numberOfLives !== 0) && (this.lastHit < 120)) {
      let startY = (this.numberOfLasers - 1) / 2 * 10;
      for (let i = 0; i < this.numberOfLasers; i++) {
        lasers.addLaser([this.actor.posx + 20, this.actor.posy + 2 - startY + (i * 10)]);
      }
    }
  }

  hit(explosions, showScore) {
    if (this.vulnerable) {
      this.numberOfLives -= 1;
      showScore.update(this.numberOfLives);
      this.lastHit = 180;
      this.numberOfLasers = 1;
      explosions.append(1, this.actor.posx, this.actor.posy);
      this.actor.posx = 100;
      this.actor.posy = 300;
      this.vulnerable = false;
    }
  }
}

class Lasers {
  constructor() {
    this.allLasers = [];
  }

  draw() {
    for (let laser of this.allLasers) {
      laser.draw();
    }
  }

  update() {
    for (let i = (this.allLasers.length - 1); i > -1; i--) {
      this.allLasers[i].posx += 20;
      if (this.allLasers[i].posx > (800 + 10)) {
        this.allLasers.splice(i, 1);
      }
    }
  }

  addLaser(position) {
    let actor = new Actor('laser');
    actor.pos = position;
    this.allLasers.push(actor);
  }
}

class PowerUps {
  constructor() {
    this.powerups = [];
  }

  draw() {
    for (let powerup of this.powerups) {
      powerup.draw();
    }
  }

  update() {
    for (let i = (this.powerups.length - 1); i > -1; i--) {
      this.powerups[i].posx -= 1;
      if (this.powerups[i].posx < -16) {
        this.powerups.splice(i, 1);
      }
    }
  }

  append(posX, posY) {
    let actor = new Actor("plus");
    actor.pos = [posX, posY];
    this.powerups.push(actor);
  }
}

class ShowScore {
  constructor(number) {
    this.ship = new Actor("lives");
    this.ship.pos = [37, 20];
    this.number1 = new Actor("text_0");
    this.number1.pos = [80, 20];
    this.number2 = new Actor("text_" + number);
    this.number2.pos = [108, 20];
  }

  draw() {
    this.ship.draw();
    this.number1.draw();
    this.number2.draw();
  }

  update(number) {
    this.number2.name = "text_" + number;
  }
}

class Explosion {
  static NAMES = ["impact_", "explosion_"];
  static FRAMES = [8, 10];

  constructor(index, posX, posY) {
    this.index = index;
    this.actor = new Actor(Explosion.NAMES[index] + "0");
    this.actor.pos = [posX, posY];
    this.imageIndex = 0;
    this.frame = 0;
  }

  draw() {
    this.actor.draw();
  }

  update() {
    this.frame += 1;
    if (0 === (this.frame % 6)) {
      this.imageIndex += 1;
      if (this.imageIndex < Explosion.FRAMES[this.index]) {
        this.actor.name = Explosion.NAMES[this.index] + this.imageIndex;
      }
      else {
        return false;
      }
    }
    return true;
  }
}

class ExplosionList {
  constructor() {
    this.explosions = [];
  }

  draw() {
    for (let explosion of this.explosions) {
      explosion.draw();
    }
  }

  update() {
    for (let i = (this.explosions.length - 1); i > -1; i--) {
      if (!this.explosions[i].update()) {
        this.explosions.splice(i, 1);
      }
    }
  }

  append(index, posX, posY) {
    this.explosions.push(new Explosion(index, posX, posY));
  }
}

function collisionShipBullets(bullets, spaceShip, explosions, showScore) {
  if (bullets.collide(spaceShip)) {
    spaceShip.hit(explosions, showScore);
  }
}

function collisionBulletsForeground(bullets, foreground, explosions) {
  for (let i = (bullets.bullets.length - 1); i > -1; i--) {
    for (let actor of foreground.elements) {
      if (actor.collidepoint(bullets.bullets[i].actor.pos)) {
        explosions.append(0, bullets.bullets[i].actor.posx, bullets.bullets[i].actor.posy);
        bullets.bullets.splice(i, 1);
        break;
      }
    }
  }
}

function collisionLaserForeground(lasers, foreground, explosions) {
  for (let j = (lasers.allLasers.length - 1); j > -1; j--) {
    for (let actor of foreground.elements) {
      let laserRect = new Rect(lasers.allLasers[j].posx - 26, lasers.allLasers[j].posy, 52, 1);
      if (actor.colliderect(laserRect)) {
        explosions.append(0, lasers.allLasers[j].posx + 26, lasers.allLasers[j].posy);
        lasers.allLasers.splice(j, 1);
        break;
      }
    }
  }
}

function collisionLaserEnemies(lasers, enemyList, explosions, powerups) {
  for (let j = (lasers.allLasers.length - 1); j > -1; j--) {
    let index = 0;
    for (let element of enemyList.listEnemies) {
      let laserRect = new Rect(lasers.allLasers[j].posx - 26, lasers.allLasers[j].posy, 52, 1);
      if (element.actor.colliderect(laserRect)) {
        explosions.append(0, lasers.allLasers[j].posx + 26, lasers.allLasers[j].posy);
        enemyList.laserHit(index, powerups, explosions);
        lasers.allLasers.splice(j, 1);
        break;
      }
      index++;
    }
  }
}

function collisionShipForeground(spaceShip, foreground, explosions, showScore) {
  let index = -1;
  for (let i = (foreground.elements.length - 1); i > -1; i--) {
    if (spaceShip.actor.colliderect(foreground.elements[i])) {
      index = i;
      break;
    }
  }
  if (index >= 0) {
    spaceShip.hit(explosions, showScore);
  }
}

function collisionShipEnemies(spaceShip, enemyList, explosions, showScore, powerups) {
  let index = -1;
  for (let i = (enemyList.listEnemies.length - 1); i > -1; i--) {
    if (spaceShip.actor.colliderect(enemyList.listEnemies[i].actor)) {
      index = i;
      break;
    }
  }
  if (index >= 0) {
    spaceShip.hit(explosions, showScore);
    enemyList.laserHit(index, powerups, explosions);
  }
}

function collisionShipPowerUps(spaceShip, powerups) {
  for (let i = (powerups.powerups.length - 1); i > -1; i--) {
    let powerupRect = new Rect(powerups.powerups[i].posx - 16, powerups.powerups[i].posy - 16, 32, 32);
    if (spaceShip.actor.colliderect(powerupRect)) {
      spaceShip.numberOfLasers += 1;
      powerups.powerups.splice(i, 1);
    }
  }
}

function loadLevel() {
  const ENEMY_DATA = LEVEL_DATA['enemy'];
  for (const name of Object.getOwnPropertyNames(ENEMY_DATA)) {
    if ('movements' in ENEMY_DATA[name]) {
      if (ENEMY_DATA[name]['movements'] === 'boss') {
        ENEMY_DATA[name].movements = BigBossMovement;
      }
      else if (ENEMY_DATA[name]['movements'] === 'accelerate') {
        ENEMY_DATA[name].movements = Accelerate;
      }
      else {
        ENEMY_DATA[name].movements = PositionFromLength;
      }
    }
    else {
      ENEMY_DATA[name].movements = PositionFromLength;
    }

    if ('bullets' in ENEMY_DATA[name]) {
      if (ENEMY_DATA[name]['bullets'] === 'boss') {
        ENEMY_DATA[name].bullets = BulletsBigBoss;
      }
      else if (ENEMY_DATA[name]['bullets'] === 'more') {
        ENEMY_DATA[name].bullets = MoreBulletsToSpaceship;
      }
      else if (ENEMY_DATA[name]['bullets'] === 'some') {
        ENEMY_DATA[name].bullets = SomeBulletsToSpaceship;
      }
      else {
        ENEMY_DATA[name].bullets = NoBullets;
      }
    }
    else {
      ENEMY_DATA[name].bullets = NoBullets;
    }
  }

  let nameSet = new Set(['spaceship']),
      width, height, mask, surface, color;

  // Add the names of foreground actually used in the level
  for (let [name, x, y] of LEVEL_DATA['foreground']) {
    nameSet.add(name);
  }
  // Add the names of enemies actually used in the level
  for (let [name, y, x] of LEVEL_DATA['start']) {
    nameSet.add(name);
  }

  for (let name of nameSet) {
    width = images[name].width;
    height = images[name].height;
    mask = new Mask(width, height);
    screen.clear('transparent');
    screen.blit(name, [0, 0]);
    surface = screen.getSurface(width, height);
    for (let x = 0; x < width; x++) {
      for (let y = 0; y < height; y++) {
        color = surface.getAt(x, y);
        if (color[3] !== 0) {
          mask.set(x, y, 1);
        }
      }
    }
    if (!mask.isSolid()) {
      // Only use the mask if there is a transparent part in the image
      MaskedActor.MASK_MAP.set(name, mask);
    }
  }
}

const Status = Object.freeze({
  PLAYING: 1,
  GAME_OVER: 2,
  LEVEL_CLEAR: 3
});

var isFastComputer, foreground, bullets, enemyList, spaceShip, lasers, powerups, showScore, explosions, gameStatus, globalTime;

function reset() {
  isFastComputer = true;
  loadLevel();

  foreground = new Foreground();
  bullets = new AllBullets();
  enemyList = new EnemyList();
  spaceShip = new SpaceShip();
  lasers = new Lasers();
  powerups = new PowerUps();
  showScore = new ShowScore(spaceShip.numberOfLives);
  explosions = new ExplosionList();

  gameStatus = Status.PLAYING;
  globalTime = 0;
}

function draw() {
  if (isFastComputer) {
    drawBackground(screen, globalTime);
  }
  else {
    screen.clear();
  }
  foreground.draw();
  enemyList.draw();
  if (gameStatus !== Status.GAME_OVER) {
    spaceShip.draw();
  }
  powerups.draw();
  lasers.draw();
  bullets.draw();
  explosions.draw();
  showScore.draw();
  if (gameStatus === Status.GAME_OVER) {
    screen.draw.text("GAME OVER", {
      center: [400, 260],
      fontsize: 55,
      color: [255, 0, 0]
    });
  }
  else if (gameStatus === Status.LEVEL_CLEAR) {
    screen.draw.text("LEVEL CLEAR", {
      center: [400, 260],
      fontsize: 55,
      color: [0, 0, 255]
    });
  }
}

function update() {
  globalTime += 1;
  bullets.update();
  lasers.update();
  powerups.update();
  foreground.update(globalTime);
  enemyList.update(globalTime, bullets, spaceShip);
  if (gameStatus !== Status.GAME_OVER) {
    if (keyboard[keys.LEFT]) {
      spaceShip.translate(-4,  0);
    }
    if (keyboard[keys.RIGHT]) {
      spaceShip.translate( 4,  0);
    }
    if (keyboard[keys.UP]) {
      spaceShip.translate( 0, -4);
    }
    if (keyboard[keys.DOWN]) {
      spaceShip.translate( 0,  4);
    }
  }
  spaceShip.update();
  explosions.update();
  collisionBulletsForeground(bullets, foreground, explosions);
  collisionLaserForeground(lasers, foreground, explosions);
  collisionLaserEnemies(lasers, enemyList, explosions, powerups);
  if (gameStatus === Status.PLAYING) {
    collisionShipBullets(bullets, spaceShip, explosions, showScore);
    collisionShipForeground(spaceShip, foreground, explosions, showScore);
    collisionShipEnemies(spaceShip, enemyList, explosions, showScore, powerups);
    collisionShipPowerUps(spaceShip, powerups);
    if (spaceShip.numberOfLives === 0) {
      gameStatus = Status.GAME_OVER;
    }
    else if ((globalTime > (LEVEL_DATA['start'][LEVEL_DATA['start'].length-1][2] + 10)) && (enemyList.listEnemies.length === 0)) {
      gameStatus = Status.LEVEL_CLEAR;
    }
  }
}

function on_key_down(key) {
  if (key === keys.SPACE) {
    spaceShip.shootLaser(lasers);
  }
}

window.addEventListener('load', (event) => {
  screen.init();
});
</script>
</body>

</html>
